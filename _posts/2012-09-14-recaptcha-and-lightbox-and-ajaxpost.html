---
category: perl
layout: post
tags:
  - javascript
title: reCaptcha and lightbox and ajaxPost
---
{% include JB/setup %}

sometimes, you want to do lightbox for Email Us or Contact Us page.<div>in this case, you don't want to include the recaptcha js in every page, you want to include it in the popup lightbox but here we have an issue that $(document).ready would be called while the google recaptcha js is not loaded. b/c document ready is just checking the original page instead of the lightbox. in this case, here is a common solution for every js loading (wait until that js loaded.)</div><div><br /></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div>&lt;script type="text/javascript" src="https://www.google.com/recaptcha/api/js/recaptcha_ajax.js"&gt;&lt;/script&gt;</div></blockquote><div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>&lt;script type="text/javascript"&gt;</div><div>&nbsp; &nbsp; $(document).ready(function(){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; var reCaptcha_timer;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; reCaptcha_timer = setInterval(function(){</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (typeof(Recaptcha) != 'undefined') {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clearInterval(reCaptcha_timer);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CreateReCaptcha();</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</div><div>&nbsp; &nbsp; &nbsp; &nbsp; }, 50);</div><div>&nbsp; &nbsp; });</div><div>&nbsp; &nbsp; function CreateReCaptcha() {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Recaptcha.create("public_key_blabla", 'captcha-placeholder', {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; theme: "white",</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callback: Recaptcha.focus_response_field</div><div>&nbsp; &nbsp; &nbsp; &nbsp; });</div><div>&nbsp; &nbsp; }</div><div>&lt;/script&gt;</div></div><div><br /></div></blockquote>see we have a tricky that keep check if Recaptcha is inited (which will be done when recatpcha_ajax.js is loaded).</div><div>and only after it's loaded, we clear the check, and create the catpcha.</div><div><br /></div><div>the trick works pretty good. but here is another issue, when the lightbox is loaded and user submits the form, and if some elements are wrong or captcha is wrong, that we need show captcha once again. it will be broken. b/c Recaptcha js variable is already defined, and Recaptcha.create will not working fine b/c it has something stored for previous captcha.</div><div><br /></div><div>in this case, another tricky is much more simpler.</div><div><br /></div><div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>&lt;script type="text/javascript"&gt;</div><div>// so that we can reload it</div><div>if (typeof(Recaptcha) != 'undefined') Recaptcha = undefined;</div><div>&lt;/script&gt;</div></div><div>&lt;script type="text/javascript" src="https://www.google.com/recaptcha/api/js/recaptcha_ajax.js"&gt;&lt;/script&gt;</div><div><br /></div></blockquote>before load the js, we reset it so it works like it's the first time we are trying to create reCaptcha.</div><div><br /></div><div>those issue only happens on ajax lightbox load reCaptcha and ajaxPost the reCaptcha form.</div><div>stupid but works.</div><div><br /></div><div>Thanks.</div>
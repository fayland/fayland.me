---
category: perl
layout: post
tags: []
title: 检测中国的假期模块
---
{% include JB/setup %}

前几天看 use.perl 的时候看到 <a href='http://use.perl.org/~jonasbn/'>jonasbn</a> 写了个 journal: <a href='http://use.perl.org/~jonasbn/journal/28046'>Date::Holidays::* - coming to your country?</a>.<br />觉得我也可以参加，就琢磨着写了个 <a href="http://search.cpan.org/perldoc?Date::Holidays::CN">Date::Holidays::CN</a><h3>perldoc</h3>目前应该可以在 CPAN 上找到。找不到的话可以访问 <a href="http://www.fayland.org/CPAN/">http://www.fayland.org/CPAN/</a><br /><pre>use Date::Holidays::CN;<p />my ($year, $month, $day) = (localtime)[ 5, 4, 3 ];<br />$year  += 1900;<br />$month += 1;<br />if (my $holidayname = is_cn_holiday( $year, $month, $day )) {<br />    print "这是个 $holidayname";<br />}<br />    <br />my $h = cn_holidays($year);<br />printf "10 月 1 日是 '%s'\n", $h->{'1001'};<br /></pre>上面这一段代码是为了符合 <a href="http://search.cpan.org/perldoc?Date::Holidays">Date::Holidays</a> 的 API 而写的。<br /><pre># suggested<br />use Date::Holidays::CN qw/is_cn_solar_holiday is_cn_lunar_holiday/;<br />my $holidayname = is_cn_solar_holiday( 2005, 10, 1 ); # $day = '国庆节'<br />my $is_holiday = is_cn_lunar_holiday( 2005, 9, 18 ); # $day = '中秋节'</pre>这一段我比较推荐。因为中国的特殊国情。:-)<h3>瑕疵</h3>目前 cn_holidays 里没有阴历的日子。打算下一版本加进去。<br />另外因为采用了 <a href="http://search.cpan.org/perldoc?DateTime::Calendar::Chinese">DateTime::Calendar::Chinese</a> 所以这速度实在是有点不可忍受。不过我找不到另外的处理阴历的模块，只好忍忍了。<h3>过程</h3>在写的过程中碰到了很奇怪的问题。这问题我发到了 <a href="http://www.perlchina.org">PerlChina</a>/BBS 和 PerlChina/Maillist 上了。<br />后来用 from_object 代替了 from_epoch, 没想到就搞定了。<br /><pre>my $dt2 = DateTime->new(<br /> &nbsp; &nbsp;year   => $year,<br /> &nbsp; &nbsp;month  => $month,<br /> &nbsp; &nbsp;day    => $day,<br /> &nbsp; &nbsp;hour   => 0,<br /> &nbsp; &nbsp;minute => 0,<br /> &nbsp; &nbsp;second => 0,<br /> &nbsp; &nbsp;nanosecond => 500000000,<br /> &nbsp; &nbsp;time_zone => 'Asia/Shanghai',<br />);<br /># ouch! the DateTime::Calendar::Chinese is a bit too slow!<br />my $dt = DateTime::Calendar::Chinese->from_object(object => $dt2);<br />return $LUNAR->{sprintf "%02d%02d", $dt->month, $dt->day};</pre>如果诸位以后有机会用到这 <a href="http://search.cpan.org/perldoc?DateTime::Calendar::Chinese">DateTime::Calendar::Chinese</a> 模块的话，小心用 from_object 可能比较好。<h3>Enjoy!</h3>如果有任何问题，可以联系我。比如说要增加某一节日。:-><br />my mail: fayland at gmail.com
---
category: javascript
layout: post
tags: []
title: AutoSave / 自动存储
---
{% include JB/setup %}

这个功能很常见。是为了防止浏览器崩溃或提交不成功而导致自己辛辛苦苦写就的东西消失掉。Gmail 里也这个东西。<br />它的原理是将该文本框的东西存储进一个 Cookie. 如果没提交成功（原因可能是浏览器崩溃），下次访问该页面时询问是否导入上次存储的东西。<p /><pre>function AutoSave(it) { // it 指调用的文本框<p /> &nbsp; &nbsp;var _value = it.value; &nbsp; &nbsp;// 获得文本框的值<br /> &nbsp; &nbsp;if (!_value) {<br /> &nbsp; &nbsp; &nbsp; &nbsp;var _LastContent = GetCookie('AutoSaveContent'); // 获得 cookie 的值，这里的 GetCookie 是个自定义函数，参见源代码<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;if (!_LastContent) return; // 如果该 cookie 没有值，说明是新的开始<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;if (confirm("Load Last AutoSave Content?")) { // 否则询问是否导入<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;it.value = _LastContent;<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return true;<br /> &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp;} else {<br /> &nbsp; &nbsp; &nbsp; &nbsp;<br /> &nbsp; &nbsp; &nbsp; &nbsp;var expDays = 30;<br /> &nbsp; &nbsp; &nbsp; &nbsp;var exp = new Date();<br /> &nbsp; &nbsp; &nbsp; &nbsp;exp.setTime( exp.getTime() + (expDays * 86400000) ); // 24*60*60*1000 = 86400000<br /> &nbsp; &nbsp; &nbsp; &nbsp;var expires='; expires=' + exp.toGMTString();<p /> &nbsp; &nbsp; &nbsp; &nbsp;// SetCookie 这里就是设置该 cookie<br /> &nbsp; &nbsp; &nbsp; &nbsp;document.cookie = "AutoSaveContent=" + escape (_value) + expires;<br /> &nbsp; &nbsp;}<br />}</pre>而这 HTML 中应当如此：<br /><pre><br />&lt;script language=JavaScript src='/javascript/AutoSave.js'>&lt;/script><br />&lt;form action="submit" method="POST" onSubmit="DeleteCookie('AutoSaveContent')"><br />&lt;textarea rows="5" cols="70" wrap="virtual" onkeyup="AutoSave(this);" onselect="AutoSave(this);" onclick="AutoSave(this);">&lt;/textarea><br />&lt;input type="submit">&lt;/form><br /></pre>第一句导入 js, 第二句的 onSubmit 指如果提交了就删除该 cookie, 而 DeleteCookie 也是自定义的一个函数。参见<a href='http://www.fayland.org/javascript/AutoSave.js'>源代码</a>。<br />textarea 里的 onkeyup 是指当按键时访问 AutoSave, 用以存储新写入的文字。<br />而 onselect 和 onclick 用以新访问时确定导入自动保存的文字。<p />大致就是如此。 Enjoy!<p />源代码：<a href="http://www.fayland.org/javascript/AutoSave.js">http://www.fayland.org/javascript/AutoSave.js</a>
---
category: perl
layout: post
tags:
  - DynamoDB
  - Moo
  - Moose
title: Net-Amazon-DynamoDB
---
{% include JB/setup %}

I have been playing with&nbsp;<a href="https://metacpan.org/module/Net::Amazon::DynamoDB">Net::Amazon::DynamoDB</a>&nbsp;a lot recently. this article is not to comment on that service. it's just a few notes for Perl guys who're using it.<div><br /></div><div>1. Moo based instead of Moose.</div><div><br /></div><div>well, if you're not using Moose in your system, Moose may be too much for your speed. I am maintain a new branch on that which converted Moose to Moo. changes can be found at&nbsp;<a href="https://github.com/fayland/Net-Amazon-DynamoDB/commit/0b3b9a493e92c85461353ef1fc1da422e4d0bb48">https://github.com/fayland/Net-Amazon-DynamoDB/commit/0b3b9a493e92c85461353ef1fc1da422e4d0bb48</a>&nbsp;and I'll update when the Moose version is updated.</div><div><br /></div><div>2. custom Cache module supports.</div><div><br /></div><div>I removed the isa =&gt; 'Cache' in the Moo version, instead, I'm using</div><div><br /></div><div><div><div>has cache =&gt; ( isa =&gt; sub {</div><div>&nbsp; &nbsp; &nbsp;die "thaw/freeze/remove must be supported in cache" unless $_[0]-&gt;can('thaw') and $_[0]-&gt;can('freeze') and $_[0]-&gt;can('remove')</div><div>}, is =&gt; 'rw', predicate =&gt; 'has_cache' );</div></div><div><br /></div></div><div>so that we can use custom layer like</div><div><br /></div><div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div><div>package My::Dummy::Cache::FastMmap;</div><div><br /></div><div>use Moo;</div><div>use Cache::FastMmap;</div><div><br /></div><div>has 'cache' =&gt; (is =&gt; 'lazy');</div><div>sub _build_cache { Cache::FastMmap-&gt;new(share_file =&gt; '/tmp/mycache_fastmmap', unlink_on_exit =&gt; 0) }</div><div><br /></div><div># Cache::FastMmap do not have thaw/freeze sub</div><div>sub thaw {</div><div>&nbsp; &nbsp; my $self = shift;</div><div>&nbsp; &nbsp; $self-&gt;cache-&gt;get(@_);</div><div>}</div><div>sub freeze {</div><div>&nbsp; &nbsp; my $self = shift;</div><div>&nbsp; &nbsp; $self-&gt;cache-&gt;set(@_);</div><div>}</div><div>sub remove {</div><div>&nbsp; &nbsp; my $self = shift;</div><div>&nbsp; &nbsp; $self-&gt;cache-&gt;remove(@_);</div><div>}</div><div><br /></div><div>1;</div></div></blockquote><br /></div><div>I have fixed some bugs for the cache system like not set while return is undef, delete on batch_write etc. but it is still not perfect b/c it's not supported inside batch_get_items yet. I may write patch for it later.</div><div><br /></div><div>3. set is not array.</div><div>well, for SS or NS. it's set. it's not array. it means there is not an order inside.</div><div>if you want something like order, we can join it as string and save it. after get, split back.</div><div><br /></div><div>Thanks.</div><div><br /></div>
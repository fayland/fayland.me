---
category: perl
layout: post
tags: ['TT2']
title: job day
---
{% include JB/setup %}

It's just another job day.<p />I'm still working at the "ticket" system. It's almost done expect the user authentication part.<p />And my previous work gets online now. Pierre(<a href='http://www.europeanservers.net/'>EuropeanServer</a>) just uploaded this script to <a href='http://www.1001forums.com/cgi-bin/commentaires.pl?langue=2&idfo=8006'>1001forums.com</a>. It's a comment system with "captcha"( <a href="http://search.cpan.org/perldoc?Authen::Captcha">Authen::Captcha</a> ).<p />That's my two paid work.<p />The open-source "<a href="http://sourceforge.net/projects/shellweb">ShellWeb</a>" finally switched from CVS to Subversion. But I'm not deeply involved since the code  is not so clear to me. Get the lastest source from:<br /><pre>svn co https://svn.sourceforge.net/svnroot/shellweb/trunk shellweb</pre>At last, I want to show your another <a href="http://www.template-toolkit.org">TT</a> tooltips I asked today.<p /><h4>TT 小提示</h4><br />我向 templates@template-toolkit.org 邮件组发送了如下这样的问题：<br /><pre>hi, all.<p />in the front of the code ,I create TT instance like this:<p />[snip]<br />use vars qw/$tt/;<br />my $tt = Template->new({ PRE_PROCESS => 'header', POST_PROCESS => 'footer', [snip] };<br />my $q = $query->param('q');<br />[snip]<br />require "$q.pl";<br />[snip]<p />but in one of $q.pl(such as mail.pl, others need the PRE_PROCESS), I don't want the PRE_PROCESS when I call $tt->process<br />is there a way to change *Config Options* after $tt is created? just like $tt->{PRE_PROCESS} = ''; or something else.<br />I don't want to create a new TT instance in this $q.pl(mail.pl) since it's ugly.<p />Thanks for your help. </pre>我的 TT 模版中启用了 PRE_PROCESS 和 POST_PROCESS 参数用于头文件和尾文件。但是程序需要发送一个邮件，而邮件的模版也是一个 tt 文件。但是这个模版不需要头尾文件（因为头文件中包含 HTML 代码，而邮件是纯文本的）。所以就需要暂时性的把 PRE_PROCESS 关闭掉。后来 Sergey Martynoff 在邮件组里回了一个：<br /><pre>For PRE_PROCESS option you can try altering<br />$tt->service->{PRE_PROCESS} (this should work, although I don't<br />think it is a good idea).</pre>总算学到了一招。最后在邮件的发送代码中大致是这样的：<br /><pre>my $body; # email Body<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />######################################3<br />## trick, we don't need the PRE_PROCESS and POST_PROCESS in the mail.tt<br />$tt->service->{PRE_PROCESS}  = [];<br />$tt->service->{POST_PROCESS} = [];<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />$tt->process('mail.tt', $tt_vars, \$body) || die $tt->error();<br /> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /># call the sub to send mail<br />require 'sendmail.pl';<br />$mail_sent = mailer(<br /> &nbsp; &nbsp;To      => $email_to,<br /> &nbsp; &nbsp;From    => $from,<br /> &nbsp; &nbsp;Subject => $subject,<br /> &nbsp; &nbsp;Body    => $body,<br />);</pre>用 $tt->service->{PRE_PROCESS}  = []; 来改变 config 中的 PRE_PROCESS.<br />have fun!
---
category: perl
layout: post
tags:
  - JavaScript
  - Selenium
title: WWW::Selenium
---
{% include JB/setup %}

<a href="http://search.cpan.org/perldoc?WWW::Selenium">WWW::Selenium</a> is a good choice when you have to test your own web application or work with a webpage full of javascript.<br /><br />well, but right now it's a pity that it doesn't support the API of Selenium 2.0. though it's still a good tool to play with.<br /><br />below is some notes that may help when you meet the issues like me.<br /><br />1. the tests may fail but you don't need worry about it.<br />actually I never made the tests passing or SYNOPSIS working because it uses wait_for_page_to_load and Google. you can try a Yahoo! search and it works.<br />one suggestion to avoid the timeout error from wait_for_page_to_load is using wait_for_element_present. wait_for_element_present works much more better in my side.<br /><br />2. get image stored<br />big thanks to <a href="http://stackoverflow.com/questions/934012/get-image-data-in-javascript">stackoverflow</a>, here is an example code.<br /><br /><blockquote>my $js = &lt;&lt;'JS';<br />var img = this.browserbot.findElement("//img[contains(@src,'captchaData')]");<br /><br />var canvas = document.createElement("canvas");<br />canvas.width = img.width;<br />canvas.height = img.height;<br /><br />var ctx = canvas.getContext("2d");<br />ctx.drawImage(img, 0, 0);<br /><br />var dataURL = canvas.toDataURL("image/png");<br /><br />dataURL.replace(/^data:image\/(png|jpg);base64,/, "");<br />JS<br /><br />my $val = $sel-&gt;get_eval($js);<br />my $bin_data = decode_base64($val); # from use MIME::Base64;<br />open(my $fh, '&gt;', "$Bin/test.jpg");<br />binmode($fh);<br />print $fh $bin_data;<br />close($fh);<br /><br /></blockquote>I'm using the firefox 3.6 and it works pretty well. canvas.toDataURL produces encoded base64 string and you can decode it then save it.<br /><br />The solution using javascript to get image stored is pretty interesting.<br /><br />3. how to get the element HTML?<br />well, this module doesn't return javascript DOM HTML to you. instead, you need always use js to get what you want. Yes. javascript is powerful.<br /><br /><blockquote>my $html = $sel-&gt;get_eval('this.browserbot.findElement("id=whatever").innerHTML');<br /><br /></blockquote>anyway, Selenium is somehow slow. I'm trying to use <a href="http://search.cpan.org/perldoc?WWW::Mechanize::Firefox">WWW::Mechanize::Firefox</a> but I don't have X in my server right now. (tried to install the mozrepl plugin through command line but no luck yet)<br /><br />I'll keep you posted. Thanks.<br />
---
category: perl
layout: post
tags: []
title: modperl Apache2::HelloWorld
---
{% include JB/setup %}

一个最标准的 <a href="http://perl.apache.org">modperl</a> 脚本可能是这样的：<br /><pre>package Apache2::F_H1;<p />use Apache2::RequestRec;<br />use Apache2::RequestIO;<br />use Apache2::Const -compile => qw(OK);<p />sub handler {<br /> &nbsp; &nbsp;my $r = shift;<br /> &nbsp; &nbsp;<br /> &nbsp; &nbsp;$r->content_type('text/html');<br /> &nbsp; &nbsp;$r->print('Hello World!');<br /> &nbsp; &nbsp;<br /> &nbsp; &nbsp;return Apache2::Const::OK;<br />}<p />1;</pre>然后在 perl.conf 或 httpd.conf 里写：<br /><pre>&lt;Perl><br /> &nbsp; &nbsp;use lib 'E:/modperl';<br />&lt;/Perl><p />PerlModule Apache2::F_H1<br />&lt;Location /h1><br />  SetHandler perl-script<br />  PerlResponseHandler Apache2::F_H1<br />&lt;/Location><br /></pre><ul>简单的解释下代码：<br /><li> <a href="http://search.cpan.org/perldoc?Apache2::RequestRec">Apache2::RequestRec</a> 用于处理请求，这里用到了它的 content_type<br /><li> <a href="http://search.cpan.org/perldoc?Apache2::RequestIO">Apache2::RequestIO</a> 则用于输入输出，这里用到了它的 print<br /><li> use <a href="http://search.cpan.org/perldoc?Apache2::Const">Apache2::Const</a> -compile => qw(OK); 则定义一些常量，这里是用到了 Apache2::Const::OK<br /><li> my $r = shift; 这个和 <a href="http://dev.catalyst.perl.org">Catalyst</a> 中程序第一句 my ( $self, $c ) = @_; 的 $c 很类似。几乎所有的 modperl 提交给 PerlResponseHandler 或其他 Perl*Handler 时，子程序第一句就必定应当是这句。<br /><li> 注意 1; 没有这个的话，Apache 很可能启动不起来。<br /></ul>而 sub handler 跟 Catalyst 中 View::<a href="http://www.template-toolkit.org">TT</a> 默认的 process 一样。如果没有指定其它的话，默认就是 handler.<br />当然我们也可以改变这个名字，如下面这样：<br /><pre>package Apache2::F_H2;<p />sub kissme {<br /> &nbsp; &nbsp;my $r = shift;<br /> &nbsp; &nbsp;<br /> &nbsp; &nbsp;$r->content_type('text/html');<br /> &nbsp; &nbsp;$r->print('Hello World!');<br /> &nbsp; &nbsp;<br /> &nbsp; &nbsp;return Apache2::Const::OK;<br />}<p />1;</pre>这样我们可以在 perl.conf 里这么写：<br /><pre>PerlModule Apache2::F_H2<br />&lt;Location /h2><br />  SetHandler modperl<br />  PerlResponseHandler Apache2::F_H2::kissme<br />&lt;/Location></pre>Handler 时指定了 kissme.<p />而这里没有那三个 use Apache2::*; 也能正常运行是因为 perl.conf 里 PerlRequire "C:/Apache2/conf/startup.pl", 且 startup.pl 载入了这一系列模块（包括这三）。<br />而 SetHandler 为什么即可以用 perl-script 又可以用 modperl 则参考 <a href='mod_perl_configuring.html'>mod_perl 配置的一些指令</a>.<p />这就是我们最简单的 Hello, World! 至此，我们可以访问 http://localhost/h2 或 h1 来享受我们的成果。